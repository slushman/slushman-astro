---

---
<toot-share></toot-share>

<script>
  class TootShare extends HTMLElement {
    static observedAttributes = ['shareText'];

    constructor() {
      super();

      const shareLink = this.querySelector('a');

      const permalink = this.getAttribute('permalink') ?? '';
      const shareText = this.getAttribute('shareText') ?? '';

      shareLink?.addEventListener('click', (e) => {
        // If the user has already entered their instance and it is in localstorage
        // write out the link href with the instance and the current page title and URL
        if(localStorage.getItem('mastodon-instance')) {
          shareLink.href = `
            https://${localStorage.getItem('mastodon-instance')}/
            share?text=${encodeURIComponent(shareText)}
            %0A${encodeURIComponent(permalink)}
          `;
        } else {
            // otherwise, prompt the user for their instance and save it to localstorage
            e.preventDefault();
            const instance = window.prompt('Please enter your Mastodon instance');
            localStorage.setItem('mastodon-instance', instance ?? '');
        }
      });
    }

    connectedCallback() {
      const shadow = this.attachShadow({ mode: 'open' });

      const listItem = document.createElement('li');
      listItem.setAttribute('style', 'flex: 1 1 0%; text-align: center;');

      const link = document.createElement('a');
      link.setAttribute('class', 'tootshare');
      link.setAttribute('href', '#');
      link.setAttribute('rel', 'noopener noreferrer');
      link.setAttribute('target', '_blank');
      link.setAttribute('style', 'display: flex; align-text: center; align-items: center; justify-content: center; min-height: 64px; min-width: 64px; border-radius: 50%;');

      const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
      svg.setAttribute('aria-labelledby', 'mastodon');
      svg.setAttribute('height', '36px');
      svg.setAttribute('viewBox', '0 0 74 79');
      svg.setAttribute('width', '36px');

      const svgTitle = document.createElement('title');
      svgTitle.setAttribute('id', 'mastodon');

      const svgPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
      svgPath.setAttribute('fill', 'white');
      svgPath.setAttribute('d', 'M73.701 17.432c-1.14-8.38-8.524-14.985-17.277-16.265C54.947.951 49.352.164 36.39.164h-.097C23.328.164 20.547.95 19.07 1.167 10.56 2.411 2.789 8.346.903 16.826-.004 21.002-.1 25.632.068 29.879c.24 6.09.287 12.17.846 18.237a84.928 84.928 0 0 0 2.018 11.96c1.792 7.268 9.047 13.316 16.156 15.784 7.61 2.573 15.794 3 23.636 1.234a35.201 35.201 0 0 0 2.56-.692c1.903-.599 4.136-1.269 5.778-2.446a.184.184 0 0 0 .075-.142v-5.877a.173.173 0 0 0-.138-.167.178.178 0 0 0-.077 0 66.19 66.19 0 0 1-15.338 1.773c-8.89 0-11.28-4.173-11.966-5.91-.55-1.502-.9-3.068-1.04-4.659a.17.17 0 0 1 .136-.175.173.173 0 0 1 .08.002 64.936 64.936 0 0 0 15.087 1.772c1.223 0 2.441 0 3.664-.032 5.111-.141 10.499-.4 15.528-1.372.125-.024.25-.046.358-.078 7.933-1.506 15.482-6.236 16.249-18.211.029-.472.1-4.939.1-5.428.004-1.662.542-11.794-.079-18.02ZM61.493 47.314H53.15V27.107c0-4.254-1.792-6.424-5.437-6.424-4.008 0-6.015 2.567-6.015 7.636V39.38h-8.291V28.32c0-5.07-2.011-7.637-6.019-7.637-3.624 0-5.434 2.17-5.437 6.424v20.207h-8.334v-20.82c0-4.255 1.098-7.634 3.294-10.14 2.265-2.499 5.237-3.782 8.925-3.782 4.27 0 7.496 1.623 9.646 4.867l2.076 3.446 2.079-3.446c2.15-3.244 5.377-4.867 9.639-4.867 3.684 0 6.656 1.283 8.928 3.783 2.197 2.502 3.295 5.882 3.295 10.139l-.008 20.82Z');

      shadow.appendChild(listItem);
      listItem.appendChild(link);
      link.appendChild(svg);
      svg.appendChild(svgTitle);
      svg.appendChild(svgPath);

      svgTitle.append('Mastodon icon');
    }
  }

  customElements.define('toot-share', TootShare);
</script>